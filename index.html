<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/webp" href="Data/Items/Contractors_Showdown_ExfilZone_Household.webp">
    <title>ExfilZone Hideout Tracker - 3rd Wipe</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #00ff88;
            --primary-dim: #00cc6a;
            --secondary: #ff4400;
            --bg-dark: #0a0e14;
            --bg-medium: #151a24;
            --bg-light: #1f2937;
            --bg-card: #1a1f2e;
            --text-primary: #e4e8f0;
            --text-secondary: #8b95a8;
            --accent-blue: #00d4ff;
            --border: #2a3544;
            --locked: #4a5568;
            --sidebar-width: 220px;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            background-image:
                radial-gradient(circle at 20% 80%, rgba(0, 255, 136, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 68, 0, 0.03) 0%, transparent 50%);
        }

        /* Sidebar Navigation */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: var(--sidebar-width);
            height: 100vh;
            background: var(--bg-medium);
            border-right: 1px solid var(--border);
            padding: 1rem 0;
            z-index: 1000;
            transition: transform 0.3s ease;
            overflow-y: auto;
        }

        .sidebar.collapsed {
            transform: translateX(calc(-1 * var(--sidebar-width)));
        }

        .sidebar-header {
            padding: 0.5rem 1rem 1rem;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .sidebar-logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 900;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .sidebar .nav-link {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            margin: 0;
            color: var(--text-secondary);
            text-decoration: none;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            border-radius: 0;
            background: transparent;
            border-top: none;
            border-right: none;
            border-bottom: none;
        }

        .sidebar .nav-link svg {
            width: 18px;
            height: 18px;
            fill: currentColor;
            flex-shrink: 0;
        }

        .sidebar .nav-link:hover {
            background: var(--bg-light);
            color: var(--text-primary);
            border-left-color: var(--accent-blue);
        }

        .sidebar .nav-link.active {
            background: rgba(0, 255, 136, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .sidebar-toggle {
            position: fixed;
            left: var(--sidebar-width);
            top: 50%;
            transform: translateY(-50%);
            width: 24px;
            height: 48px;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-left: none;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: left 0.3s ease;
        }

        .sidebar-toggle:hover {
            background: var(--bg-light);
        }

        .sidebar-toggle svg {
            width: 16px;
            height: 16px;
            fill: var(--text-secondary);
            transition: transform 0.3s ease;
        }

        .sidebar.collapsed + .sidebar-toggle {
            left: 0;
        }

        .sidebar.collapsed + .sidebar-toggle svg {
            transform: rotate(180deg);
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            transition: margin-left 0.3s ease;
            min-height: 100vh;
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            text-align: center;
            padding-bottom: 2rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--primary);
        }

        h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem;
            font-weight: 900;
            letter-spacing: 4px;
            text-transform: uppercase;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent-blue) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .subtitle {
            font-size: 1rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 3px;
        }

        .nav-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
            padding: 0.5rem 1rem;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            color: var(--accent-blue);
            text-decoration: none;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .nav-link:hover {
            border-color: var(--accent-blue);
            background: var(--bg-light);
        }

        .nav-link svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-left: 3px solid var(--primary);
            padding: 1rem;
            text-align: center;
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.25rem;
        }

        .stat-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        /* Filter Section */
        .filter-section {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            max-width: 400px;
            padding: 0.75rem 1rem;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'Rajdhani', sans-serif;
            font-size: 1rem;
            border-radius: 4px;
        }

        .search-box:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
        }

        .filter-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .filter-btn.active {
            background: var(--primary);
            color: var(--bg-dark);
            border-color: var(--primary);
        }

        .filter-btn.favorite {
            border-color: var(--accent-yellow);
            color: var(--accent-yellow);
        }

        .filter-btn.favorite.active {
            background: var(--accent-yellow);
            color: var(--bg-dark);
        }

        /* Category Section */
        .category-section {
            margin-bottom: 2rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: linear-gradient(90deg, var(--bg-light) 0%, transparent 100%);
            border-left: 4px solid var(--primary);
            margin-bottom: 1rem;
        }

        .category-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: var(--primary);
        }

        .category-progress {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Cards Grid */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1rem;
        }

        /* Upgrade Card */
        .upgrade-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .upgrade-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.1);
        }

        .upgrade-card.completed {
            opacity: 0.6;
            border-color: var(--primary);
        }

        .upgrade-card.completed .card-header {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.2) 0%, var(--bg-light) 100%);
        }

        .upgrade-card.completed .completed-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 28px;
            height: 28px;
            background: var(--primary);
            color: var(--bg-dark);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
        }

        .upgrade-card.locked {
            opacity: 0.5;
            border-color: var(--locked);
        }

        .upgrade-card.locked .card-header {
            background: linear-gradient(135deg, rgba(74, 85, 104, 0.3) 0%, var(--bg-light) 100%);
        }

        .upgrade-card.locked .locked-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            width: 28px;
            height: 28px;
            background: var(--locked);
            color: var(--text-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .upgrade-card.locked:hover {
            border-color: var(--secondary);
            cursor: not-allowed;
        }

        .favorite-btn {
            width: 28px;
            height: 28px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            transition: all 0.2s;
            color: var(--text-secondary);
            flex-shrink: 0;
        }

        .favorite-btn:hover {
            background: var(--bg-medium);
            border-color: var(--accent-yellow);
            transform: scale(1.1);
        }

        .favorite-btn.active {
            color: var(--accent-yellow);
            background: rgba(251, 191, 36, 0.2);
            border-color: var(--accent-yellow);
        }

        .card-header {
            background: var(--bg-light);
            padding: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .card-title-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-level {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--accent-blue) 100%);
            color: var(--bg-dark);
            border-radius: 3px;
        }

        .card-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .card-image {
            width: 100%;
            height: 120px;
            overflow: hidden;
            border-bottom: 1px solid var(--border);
        }

        .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .upgrade-card:hover .card-image img {
            transform: scale(1.05);
        }

        .card-body {
            padding: 1rem;
        }

        .requirements-label {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.75rem;
        }

        .requirements-label::before {
            content: '';
            width: 16px;
            height: 16px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%238b95a8' viewBox='0 0 24 24'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z'/%3E%3C/svg%3E") center/contain no-repeat;
        }

        .card-price {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            padding: 0.5rem;
            background: var(--bg-dark);
            border-radius: 4px;
        }

        .price-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            color: #000;
        }

        .price-value {
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent-blue);
        }

        .items-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .item-row {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-dark);
            border-radius: 4px;
        }

        .item-icon {
            width: 36px;
            height: 36px;
            object-fit: contain;
            border: 1px solid var(--border);
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px;
        }

        .item-name {
            flex: 1;
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .item-name a {
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .item-name a:hover {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        .item-quantity {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9rem;
        }

        .item-category-badge {
            font-size: 0.6rem;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
            white-space: nowrap;
        }

        .item-category-badge.cat-building { background: rgba(139, 90, 43, 0.3); color: #d4a574; border: 1px solid #8b5a2b; }
        .item-category-badge.cat-tools { background: rgba(100, 100, 100, 0.3); color: #aaa; border: 1px solid #666; }
        .item-category-badge.cat-electric { background: rgba(0, 150, 255, 0.2); color: #4da6ff; border: 1px solid #0066cc; }
        .item-category-badge.cat-household { background: rgba(255, 182, 193, 0.2); color: #ffb6c1; border: 1px solid #ff69b4; }
        .item-category-badge.cat-combustible { background: rgba(255, 100, 0, 0.2); color: #ff8c00; border: 1px solid #cc5500; }
        .item-category-badge.cat-highvalue { background: rgba(255, 215, 0, 0.2); color: #ffd700; border: 1px solid #daa520; }
        .item-category-badge.cat-food { background: rgba(144, 238, 144, 0.2); color: #90ee90; border: 1px solid #228b22; }
        .item-category-badge.cat-medical { background: rgba(255, 0, 0, 0.15); color: #ff6b6b; border: 1px solid #cc0000; }

        .no-items {
            font-style: italic;
            color: var(--text-secondary);
            font-size: 0.85rem;
            text-align: center;
            padding: 1rem;
        }

        .card-footer {
            padding: 0.75rem 1rem;
            background: var(--bg-dark);
            border-top: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .prereq-label {
            color: var(--locked);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Controls */
        .controls {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.2s;
            border-radius: 4px;
        }

        .btn.primary {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn.primary:hover {
            background: var(--primary);
            color: var(--bg-dark);
        }

        .btn.danger {
            border-color: var(--secondary);
            color: var(--secondary);
        }

        .btn.danger:hover {
            background: var(--secondary);
            color: var(--bg-dark);
        }

        .version-footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: 2rem;
            color: var(--text-secondary);
            font-size: 0.8rem;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        /* Items Summary Section */
        .items-summary-section {
            margin-bottom: 2rem;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .items-summary-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-light);
            cursor: pointer;
            transition: background 0.2s;
        }

        .items-summary-header:hover {
            background: var(--bg-card);
        }

        .items-summary-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-blue);
        }

        .items-summary-title::before {
            content: '';
            width: 20px;
            height: 20px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%2300d4ff' viewBox='0 0 24 24'%3E%3Cpath d='M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14h-2v-4H6v-2h4V7h2v4h4v2h-4v4z'/%3E%3C/svg%3E") center/contain no-repeat;
        }

        .items-summary-toggle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            transition: transform 0.3s;
        }

        .items-summary-section.expanded .items-summary-toggle {
            transform: rotate(180deg);
        }

        .items-summary-content {
            display: none;
            padding: 1rem;
        }

        .items-summary-section.expanded .items-summary-content {
            display: block;
        }

        .items-summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 0.5rem;
        }

        .summary-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: var(--bg-dark);
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        .summary-item-icon {
            width: 32px;
            height: 32px;
            object-fit: contain;
            border: 1px solid var(--border);
            border-radius: 3px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px;
        }

        .summary-item-name {
            flex: 1;
            font-size: 0.85rem;
            color: var(--text-primary);
        }

        .summary-item-name a {
            color: var(--text-primary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .summary-item-name a:hover {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        .summary-item-qty {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            color: var(--primary);
            font-size: 0.9rem;
            min-width: 40px;
            text-align: right;
        }

        .items-summary-empty {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .items-summary-stats {
            display: flex;
            gap: 1.5rem;
            padding: 0.75rem 1rem;
            background: var(--bg-dark);
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .items-summary-stats span {
            color: var(--primary);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }

        /* Up Next Section */
        .up-next-section {
            margin-bottom: 2rem;
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
        }

        .up-next-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: var(--bg-light);
            cursor: pointer;
            transition: background 0.2s;
        }

        .up-next-header:hover {
            background: var(--bg-card);
        }

        .up-next-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-yellow);
        }

        .up-next-title::before {
            content: '';
            width: 20px;
            height: 20px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fbbf24' viewBox='0 0 24 24'%3E%3Cpath d='M12 4l-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z'/%3E%3C/svg%3E") center/contain no-repeat;
        }

        .up-next-toggle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            transition: transform 0.3s;
        }

        .up-next-section.expanded .up-next-toggle {
            transform: rotate(180deg);
        }

        .up-next-content {
            display: none;
            padding: 1rem;
        }

        .up-next-section.expanded .up-next-content {
            display: block;
        }

        .up-next-upgrades {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .up-next-upgrade {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.75rem 1rem;
        }

        .up-next-upgrade-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .up-next-upgrade-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .up-next-upgrade-level {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            color: var(--primary);
            background: rgba(0, 255, 136, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .up-next-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .up-next-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.3rem 0.5rem;
            background: var(--bg-medium);
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .up-next-item a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .up-next-item a:hover {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        .up-next-item-icon {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        .up-next-item-qty {
            color: var(--primary);
            font-weight: 600;
        }

        .up-next-stats {
            display: flex;
            gap: 1.5rem;
            padding: 0.75rem 1rem;
            background: var(--bg-dark);
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .up-next-stats span {
            color: var(--accent-yellow);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }

        /* Favorites Section */
        .favorites-section {
            margin-bottom: 2rem;
            background: var(--bg-medium);
            border: 1px solid var(--accent-yellow);
            border-radius: 8px;
            overflow: hidden;
        }

        .favorites-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.1) 0%, var(--bg-light) 100%);
            cursor: pointer;
            transition: background 0.2s;
        }

        .favorites-header:hover {
            background: linear-gradient(90deg, rgba(251, 191, 36, 0.15) 0%, var(--bg-card) 100%);
        }

        .favorites-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-yellow);
        }

        .favorites-title::before {
            content: '★';
            font-size: 1.2rem;
        }

        .favorites-toggle {
            font-size: 1.2rem;
            color: var(--text-secondary);
            transition: transform 0.3s;
        }

        .favorites-section.expanded .favorites-toggle {
            transform: rotate(180deg);
        }

        .favorites-content {
            display: none;
            padding: 1rem;
        }

        .favorites-section.expanded .favorites-content {
            display: block;
        }

        .favorites-upgrades {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .favorites-upgrade {
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-left: 3px solid var(--accent-yellow);
            border-radius: 6px;
            padding: 0.75rem 1rem;
        }

        .favorites-upgrade.completed {
            opacity: 0.6;
            border-left-color: var(--primary);
        }

        .favorites-upgrade-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }

        .favorites-upgrade-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .favorites-upgrade-level {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            color: var(--accent-yellow);
            background: rgba(251, 191, 36, 0.1);
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
        }

        .favorites-upgrade.completed .favorites-upgrade-level {
            color: var(--primary);
            background: rgba(0, 255, 136, 0.1);
        }

        .favorites-items {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .favorites-item {
            display: flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.3rem 0.5rem;
            background: var(--bg-medium);
            border-radius: 4px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .favorites-item a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .favorites-item a:hover {
            color: var(--accent-blue);
            text-decoration: underline;
        }

        .favorites-item-icon {
            width: 20px;
            height: 20px;
            object-fit: contain;
        }

        .favorites-item-qty {
            color: var(--primary);
            font-weight: 600;
        }

        .favorites-stats {
            display: flex;
            gap: 1.5rem;
            padding: 0.75rem 1rem;
            background: var(--bg-dark);
            border-top: 1px solid var(--border);
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .favorites-stats span {
            color: var(--accent-yellow);
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
        }

        .favorites-empty {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(calc(-1 * var(--sidebar-width)));
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .sidebar-toggle {
                left: 0;
            }

            .sidebar.mobile-open + .sidebar-toggle {
                left: var(--sidebar-width);
            }

            .sidebar.mobile-open + .sidebar-toggle svg {
                transform: rotate(180deg);
            }

            .main-content {
                margin-left: 0;
            }

            h1 { font-size: 1.75rem; }
            .container { padding: 1rem; }
            .cards-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
        }

        /* DLC Button */
        .dlc-button {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-medium);
            border: 1px solid var(--accent-yellow);
            color: var(--accent-yellow);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .dlc-button:hover {
            background: var(--accent-yellow);
            color: var(--bg-dark);
        }

        .dlc-button svg {
            width: 16px;
            height: 16px;
            fill: currentColor;
        }

        /* DLC Modal */
        .dlc-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .dlc-modal-overlay.active {
            display: flex;
        }

        .dlc-modal {
            background: var(--bg-medium);
            border: 1px solid var(--border);
            border-radius: 12px;
            max-width: 700px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .dlc-modal-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: var(--bg-light);
            border-bottom: 1px solid var(--border);
        }

        .dlc-modal-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-family: 'Orbitron', sans-serif;
            font-size: 1rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--accent-yellow);
        }

        .dlc-modal-title::before {
            content: '';
            width: 20px;
            height: 20px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='%23fbbf24' viewBox='0 0 24 24'%3E%3Cpath d='M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z'/%3E%3C/svg%3E") center/contain no-repeat;
        }

        .dlc-modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            line-height: 1;
            transition: color 0.2s;
        }

        .dlc-modal-close:hover {
            color: var(--text-primary);
        }

        .dlc-modal-content {
            padding: 1.5rem;
        }

        .dlc-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1rem;
        }

        .dlc-card {
            background: var(--bg-dark);
            border: 2px solid var(--border);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
        }

        .dlc-card:hover {
            border-color: var(--accent-yellow);
        }

        .dlc-card.selected {
            border-color: var(--primary);
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }

        .dlc-card-image {
            width: 100%;
            height: 140px;
            overflow: hidden;
            border-bottom: 1px solid var(--border);
            background: var(--bg-medium);
        }

        .dlc-card-image img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            object-position: center;
            transition: transform 0.3s;
        }

        .dlc-card:hover .dlc-card-image img {
            transform: scale(1.05);
        }

        .dlc-card-body {
            padding: 1rem;
        }

        .dlc-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .dlc-card-name {
            font-family: 'Orbitron', sans-serif;
            font-size: 0.9rem;
            font-weight: 700;
            color: var(--accent-yellow);
        }

        .dlc-checkbox {
            width: 20px;
            height: 20px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .dlc-unlocks {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .dlc-unlocks strong {
            color: var(--primary);
            font-weight: 600;
        }

        .dlc-modal-footer {
            padding: 0.75rem 1.5rem;
            background: var(--bg-dark);
            border-top: 1px solid var(--border);
            font-size: 0.8rem;
            color: var(--text-secondary);
            text-align: center;
        }
    </style>
</head>
<body>
    <!-- DLC Modal -->
    <div class="dlc-modal-overlay" id="dlcModal" onclick="closeDlcModal(event)">
        <div class="dlc-modal" onclick="event.stopPropagation()">
            <div class="dlc-modal-header">
                <div class="dlc-modal-title">DLC Ownership</div>
                <button class="dlc-modal-close" onclick="closeDlcModal()">&times;</button>
            </div>
            <div class="dlc-modal-content">
                <div class="dlc-grid">
                    <div class="dlc-card" id="dlc-ntg" onclick="toggleDlc('ntg')">
                        <div class="dlc-card-image">
                            <img src="Images/DLCs/NTG Standard Issue.jpg" alt="NTG Standard Issue">
                        </div>
                        <div class="dlc-card-body">
                            <div class="dlc-card-header">
                                <span class="dlc-card-name">NTG Standard Issue</span>
                                <input type="checkbox" class="dlc-checkbox" id="dlc-ntg-checkbox" onclick="event.stopPropagation(); toggleDlc('ntg')">
                            </div>
                            <div class="dlc-unlocks">
                                Unlocks: <strong>Workshop</strong>, <strong>TV Set Lv1</strong>, <strong>Water Collector Lv1</strong><br>
                                + HQ Power Fuel Can L (1 pc.)
                            </div>
                        </div>
                    </div>
                    <div class="dlc-card" id="dlc-johnny" onclick="toggleDlc('johnny')">
                        <div class="dlc-card-image">
                            <img src="Images/DLCs/Johnny's secret stash.jpg" alt="Johnny's Secret Stash">
                        </div>
                        <div class="dlc-card-body">
                            <div class="dlc-card-header">
                                <span class="dlc-card-name">Johnny's Secret Stash</span>
                                <input type="checkbox" class="dlc-checkbox" id="dlc-johnny-checkbox" onclick="event.stopPropagation(); toggleDlc('johnny')">
                            </div>
                            <div class="dlc-unlocks">
                                Unlocks: <strong>Workshop</strong>, <strong>Storage Room A</strong>, <strong>Shooting Range Lv1</strong>, <strong>Intel Center Lv1</strong><br>
                                + Merchants to Trust Level 2 (except Johnny)<br>
                                + HQ Power Fuel Can L (2 pcs.)
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="dlc-modal-footer">
                Select the DLCs you own to automatically mark unlocked hideout upgrades as complete
            </div>
        </div>
    </div>

    <!-- Sidebar Navigation -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">ExfilZone</div>
        </div>
        <a href="index.html" class="nav-link active">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg>
            Hideout Tracker
        </a>
        <a href="items.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-9 9H4V4h7v7zm9 0h-7V4h7v7zm-9 9H4v-7h7v7zm9 0h-7v-7h7v7z"/></svg>
            Item Database
        </a>
        <a href="itemspawns.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            Item Spawns
        </a>
        <a href="ammo.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-4h2v-2h2v-2h-2V8h-2v4H9v2h2v2z"/></svg>
            Ammo TTK Chart
        </a>
        <a href="keys.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.65 10A5.99 5.99 0 0 0 7 6c-3.31 0-6 2.69-6 6s2.69 6 6 6a5.99 5.99 0 0 0 5.65-4H17v4h4v-4h2v-4H12.65zM7 14c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>
            Key Vault Guide
        </a>
        <a href="keyspawns.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
            Key Spawns
        </a>
        <a href="maps.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z"/></svg>
            Interactive Maps
        </a>
        <a href="tasks.html" class="nav-link">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
            Task Guide
        </a>
    </nav>

    <!-- Sidebar Toggle Button -->
    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>
    </button>

    <!-- Main Content -->
    <div class="main-content">
        <div class="container">
            <header>
                <h1>HIDEOUT TRACKER</h1>
                <div class="subtitle">ExfilZone 3rd Wipe</div>
                <button class="dlc-button" onclick="openDlcModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>
                    DLC Ownership
                </button>
            </header>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Progress</div>
                <div class="stat-value" id="progressPercent">0%</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Completed</div>
                <div class="stat-value" id="completedCount">0/55</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Total Cost</div>
                <div class="stat-value" id="totalCost">$0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Spent</div>
                <div class="stat-value" id="moneySpent">$0</div>
            </div>
        </div>

        <div class="filter-section">
            <input type="text" class="search-box" id="searchBox" placeholder="Search upgrades or items...">
            <button class="filter-btn active" onclick="filterView('all')">All</button>
            <button class="filter-btn" onclick="filterView('incomplete')">Available</button>
            <button class="filter-btn" onclick="filterView('completed')">Maxed</button>
            <button class="filter-btn favorite" onclick="filterView('favorites')">★ Favorites</button>
        </div>

        <div class="favorites-section expanded" id="favoritesSection" style="display: none;">
            <div class="favorites-header" onclick="toggleFavoritesSection()">
                <div class="favorites-title">Favorites</div>
                <div class="favorites-toggle">▼</div>
            </div>
            <div class="favorites-content">
                <div class="favorites-upgrades" id="favoritesUpgrades"></div>
            </div>
            <div class="favorites-stats" id="favoritesStats"></div>
        </div>

        <div class="items-summary-section" id="itemsSummarySection">
            <div class="items-summary-header" onclick="toggleItemsSummary()">
                <div class="items-summary-title">Items Needed</div>
                <div class="items-summary-toggle">▼</div>
            </div>
            <div class="items-summary-content">
                <div class="items-summary-grid" id="itemsSummaryGrid"></div>
            </div>
            <div class="items-summary-stats" id="itemsSummaryStats"></div>
        </div>

        <div class="up-next-section" id="upNextSection">
            <div class="up-next-header" onclick="toggleUpNext()">
                <div class="up-next-title">Up Next</div>
                <div class="up-next-toggle">▼</div>
            </div>
            <div class="up-next-content">
                <div class="up-next-upgrades" id="upNextUpgrades"></div>
            </div>
            <div class="up-next-stats" id="upNextStats"></div>
        </div>

        <div id="upgradesContainer"></div>

        <div class="controls">
            <button class="btn primary" onclick="toggleAll(true)">Mark All Complete</button>
            <button class="btn danger" onclick="toggleAll(false)">Mark All Incomplete</button>
            <button class="btn danger" onclick="resetProgress()">Reset Progress</button>
        </div>

        <div class="version-footer">
            v2.0.0 | Last Updated: January 4, 2025<br>
            Hideout data from <a href="https://abolethvr.substack.com/p/hideout-upgrade-items-in-exfilzone" target="_blank" style="color: var(--accent-blue);">AbolethVR</a> | Many images sourced from <a href="https://www.exfil-zone-assistant.app" target="_blank" style="color: var(--accent-blue);">Exfil Zone Assistant</a><br>
            <span style="opacity: 0.7; font-size: 0.7rem;">All game content and assets are property of Caveman Studio</span>
        </div>
    </div>

    <script>
        // Item categories mapping
        const itemCategories = {
            // Building
            "Boxed Nails": "Building", "Boxed Bolts": "Building", "Boxed Nuts": "Building",
            "Ceramic adhesive": "Building", "Copper wire": "Building", "Insulating Tape": "Building",
            "Super Glue": "Building", "Instant glue": "Building", "Piezometer": "Building",
            "Valve": "Building", "Climbing rope": "Building",
            // Tools
            "Hammer": "Tools", "Large Plier": "Tools", "Moldboard": "Tools", "Screwdriver": "Tools",
            "Wrench": "Tools", "Wire Cutter": "Tools", "ElectricDrill": "Tools", "Spark Plug": "Tools",
            "Tire Sealant": "Tools", "Gas pipe pliers": "Tools",
            // Electric
            "CPU": "Electric", "CPU Fan": "Electric", "RAM": "Electric", "Hard Drive": "Electric",
            "Floppydisk": "Electric", "CD": "Electric", "Tape": "Electric", "Recorder": "Electric",
            "Size D battery1": "Electric", "Size D battery2": "Electric", "Ion Battery": "Electric",
            "Marine battery": "Electric", "Vehicle battery": "Electric", "Small storage battery": "Electric",
            "Civil Radio": "Electric", "Radio": "Electric", "Power Bank": "Electric",
            "Flash light": "Electric", "Energy-saving lamp": "Electric", "UV lamp": "Electric",
            "Socket": "Electric", "Videotape": "Electric", "Voltage transformer": "Electric",
            "Imaging module": "Electric", "Digital sensor": "Electric", "NewPhone": "Electric",
            "OldPhone": "Electric", "wastechip": "Electric",
            // Household
            "Cleaner": "Household", "BeardOil": "Household", "Deodorant": "Household",
            "Pet Shampoo": "Household", "Toilet Paper": "Household", "Rust cleaner": "Household",
            "Disinfectant wipes": "Household", "Pesticide": "Household", "Rat Poison": "Household",
            // Combustible
            "Gas can": "Combustible", "Large gas can": "Combustible", "Oil can": "Combustible",
            "Lighter fluid": "Combustible", "Lighter": "Combustible", "Gun oil": "Combustible",
            "Gunpowder": "Combustible", "Smokeless powder": "Combustible", "Spray can": "Combustible",
            "WD-40": "Combustible", "Windproof Matches": "Combustible",
            // High Value
            "Game console": "High Value", "Defibrillator": "High Value", "Centrifuge": "High Value",
            "Antiquarian Book": "High Value", "Computer manual": "High Value", "Magazine": "High Value",
            "Notebook": "High Value",
            // Food & Consumables
            "Olive oil": "Food", "Salt can": "Food",
            // Medical
            "Aspirin": "Medical", "Band-aids": "Medical", "Bottled glucose": "Medical",
            "Portable medical kit": "Medical", "Medical scissors": "Medical", "Iodine": "Medical",
            "Asthma medicine": "Medical"
        };

        // Item to image URL mapping
        const itemImages = {
            "Aspirin": "Images/Items/Aspirin.png",
            "Antiquarian Book": "Images/Items/Antique book.png",
            "Band-aids": "Images/Items/Adhesive bandages.png",
            "Bottled glucose": "Images/Items/Bottled glucose.png",
            "CPU": "Images/Items/CPU.png",
            "Size D battery1": "Images/Items/Size D battery1.png",
            "Spark Plug": "Images/Items/Spark Plug.png",
            "Valve": "Images/Items/Valve.png",
            "Hard Drive": "Images/Items/Hard drive.png",
            "BeardOil": "Images/Items/BeardOil.png",
            "Boxed Bolts": "Images/Items/Boxed Bolts.png",
            "Boxed Nails": "Images/Items/Boxed Nails.png",
            "Boxed Nuts": "Images/Items/Boxed Nuts.png",
            "Ceramic adhesive": "Images/Items/Ceramic adhesive.png",
            "Cleaner": "Images/Items/Cleaner.png",
            "Climbing rope": "Images/Items/Climbing rope.png",
            "Copper wire": "Images/Items/Copper wire.png",
            "Oil can": "Images/Items/Oil can.png",
            "CPU Fan": "Images/Items/CPU Fan.png",
            "Size D battery2": "Images/Items/Size D battery2.png",
            "Centrifuge": "Images/Items/Centrifuge.png",
            "Tape": "Images/Items/Tape.png",
            "Defibrillator": "Images/Items/Defibrillator.png",
            "Deodorant": "Images/Items/Deodorant.png",
            "Disinfectant wipes": "Images/Items/Disinfectant wipes.png",
            "Energy-saving lamp": "Images/Items/Energy-saving lamp.png",
            "Marine battery": "Images/Items/Marine Battery.png",
            "UV lamp": "Images/Items/UV lamp.png",
            "Salt can": "Images/Items/Salt can.png",
            "Floppydisk": "Images/Items/Floppy Disk.png",
            "Game console": "Images/Items/Game console.png",
            "Gas pipe pliers": "Images/Items/Gas pipe pliers.png",
            "Gun oil": "Images/Items/Gun oil.png",
            "Gunpowder": "Images/Items/Gunpowder.png",
            "Flash light": "Images/Items/Flash light.png",
            "Civil Radio": "Images/Items/Civil radio.webp",
            "Power Bank": "Images/Items/Power Bank.png",
            "Videotape": "Images/Items/Videotape.webp",
            "Hammer": "Images/Items/Hammer.png",
            "Imaging module": "Images/Items/Imaging module.png",
            "Instant glue": "Images/Items/Instant glue.png",
            "Insulating Tape": "Images/Items/Insulating Tape.png",
            "Iodine": "Images/Items/Iodine.png",
            "Ion Battery": "Images/Items/Ion Battery.png",
            "Lighter fluid": "Images/Items/Lighter fluid.png",
            "Radio": "Images/Items/Portable Radio.webp",
            "Rat Poison": "Images/Items/Rat poison.webp",
            "Notebook": "Images/Items/Notebook.png",
            "Gas can": "Images/Items/Gas can.png",
            "Lighter": "Images/Items/Lighter.png",
            "Vehicle battery": "Images/Items/Car Battery.png",
            "Portable medical kit": "Images/Items/Portable medical kit.png",
            "ElectricDrill": "Images/Items/Electric drill.png",
            "Spray can": "Images/Items/Spray Can.png",
            "Medical scissors": "Images/Items/Medical scissors.png",
            "Large gas can": "Images/Items/Large gas can.png",
            "Large Plier": "Images/Items/Large Plier.png",
            "Magazine": "Images/Items/Magazine.png",
            "Moldboard": "Images/Items/Moldboard.png",
            "NewPhone": "Images/Items/NewPhone.png",
            "OldPhone": "Images/Items/Old Phone.png",
            "Voltage transformer": "Images/Items/Voltage transformer.png",
            "Digital sensor": "Images/Items/Digital sensor.webp",
            "Asthma medicine": "Images/Items/Asthma medicine.webp",
            "wastechip": "Images/Items/Waste Chip.png",
            "Olive oil": "Images/Items/Olive oil.png",
            "RAM": "Images/Items/RAM.png",
            "CD": "Images/Items/CD.png",
            "Recorder": "Images/Items/Recorder.png",
            "WD-40": "Images/Items/WD-40.png",
            "Computer manual": "Images/Items/Computer manual.png",
            "Pesticide": "Images/Items/Pesticide.png",
            "Pet Shampoo": "Images/Items/Pet Shampoo.png",
            "Piezometer": "Images/Items/Piezometer.png",
            "Rust cleaner": "Images/Items/Rust cleaner.png",
            "Screwdriver": "Images/Items/Screwdriver.png",
            "Small storage battery": "Images/Items/Small storage battery.png",
            "Smokeless powder": "Images/Items/Smokeless powder.png",
            "Socket": "Images/Items/Socket.png",
            "Super Glue": "Images/Items/Super Glue.png",
            "Tire Sealant": "Images/Items/Tire Sealant.png",
            "Toilet Paper": "Images/Items/Toilet Paper.png",
            "Windproof Matches": "Images/Items/Windproof Matches.png",
            "Wire Cutter": "Images/Items/Wire Cutter.png",
            "Wrench": "Images/Items/Wrench.png"
        };

        // Hideout location images
        const hideoutImages = {
            "Workshop": "Images/Hideout/Gunsmith.webp",
            "Storage Room A": "Images/Hideout/Storage Room A.webp",
            "Storage Room B": "Images/Hideout/Storage Room B.webp",
            "Storage Room C": "Images/Hideout/Storage Room C.webp",
            "Toilet": "Images/Hideout/Toilet.webp",
            "Sofa": "Images/Hideout/Sofa.webp",
            "TV Set": "Images/Hideout/TV Set.webp",
            "Bookdesk": "Images/Hideout/Bookdesk.webp",
            "Generator": "Images/Hideout/Generator.webp",
            "Intel Center": "Images/Hideout/Intel Center.webp",
            "Bitcoin Mine": "Images/Hideout/Bitcoin Mine.webp",
            "Shooting Range": "Images/Hideout/Shooting Range.webp",
            "Kitchen Area": "Images/Hideout/Kitchen Area.webp",
            "Water Collector": "Images/Hideout/Water Collector.webp",
            "Refrigerator": "Images/Hideout/Refrigerator.webp",
            "Microwave": "Images/Hideout/Microwave.webp",
            "Coffee Maker": "Images/Hideout/Coffee Maker.webp",
            "Medical Area": "Images/Hideout/Medical Area.webp",
            "Operating Bed": "Images/Hideout/Operating Bed.webp",
            "Med Desk": "Images/Hideout/Medical Station.webp",
            "Plant Stand": "Images/Hideout/Plant Stand.webp",
            "Gunsmith": "Images/Hideout/Gunsmith.webp"
        };

        const hideoutGroups = {
            "Workshop": ["Workshop", "Storage Room A", "Storage Room B", "Storage Room C"],
            "Living Quarters": ["Toilet", "Sofa", "TV Set", "Bookdesk"],
            "Tech & Utility": ["Generator", "Intel Center", "Bitcoin Mine", "Shooting Range"],
            "Kitchen Area": ["Kitchen Area", "Water Collector", "Refrigerator", "Microwave", "Coffee Maker"],
            "Medical": ["Medical Area", "Operating Bed", "Med Desk", "Plant Stand"],
            "Gunsmith": ["Gunsmith"]
        };

        const hideoutUpgrades = [
            // Workshop
            { name: "Workshop", level: 1, description: "Access to more storage spaces. Access to Armor Repair, Ammo loader and Keys hanger.", price: 50000, items: [], requirements: "" },
            { name: "Storage Room A", level: 1, description: "Access to storage room A", price: 80000, items: [["Boxed Nails", 3], ["Boxed Bolts", 3], ["Disinfectant wipes", 3], ["Large gas can", 3]], requirements: "Workshop 1" },
            { name: "Storage Room B", level: 1, description: "Access to storage room B", price: 400000, items: [["Large gas can", 6], ["Wrench", 6], ["Screwdriver", 6], ["Small storage battery", 6]], requirements: "Workshop 1" },
            { name: "Storage Room C", level: 1, description: "Access to storage room C", price: 400000, items: [["Gunpowder", 10], ["Smokeless powder", 10], ["Piezometer", 8], ["Imaging module", 6]], requirements: "Workshop 1" },
            // Living Quarters
            { name: "Toilet", level: 1, description: "Character experience gain +2%", price: 120000, items: [["Toilet Paper", 2], ["Hammer", 1], ["Pesticide", 1], ["Rust cleaner", 1]], requirements: "\"Homecoming\" Water Collector 1" },
            { name: "Toilet", level: 2, description: "Character experience gain +5%", price: 228000, items: [["Toilet Paper", 3], ["BeardOil", 3], ["Cleaner", 3], ["Pet Shampoo", 3]], requirements: "Toilet 1 Player Level 1" },
            { name: "Toilet", level: 3, description: "Character experience gain +10%", price: 350000, items: [["Toilet Paper", 8], ["Deodorant", 8], ["Pet Shampoo", 5], ["Piezometer", 5]], requirements: "Toilet 1 Player Level 1" },
            { name: "Sofa", level: 1, description: "Increase weight bearing capacity to 75", price: 50000, items: [["Climbing rope", 5], ["Tire Sealant", 3], ["Large Plier", 3], ["Hammer", 5]], requirements: "\"Homecoming\" Workshop 1" },
            { name: "Sofa", level: 2, description: "Increase weight bearing capacity to 80", price: 128000, items: [["Super Glue", 2], ["Magazine", 5], ["Insulating Tape", 8], ["Climbing rope", 5]], requirements: "Generator 2" },
            { name: "Sofa", level: 3, description: "Increase weight bearing capacity to 90", price: 500000, items: [["Game console", 2], ["Tire Sealant", 8], ["Deodorant", 6], ["Defibrillator", 1]], requirements: "Generator 3" },
            { name: "TV Set", level: 1, description: "Scavenger mode CD -10%", price: 50000, items: [["Size D battery1", 3], ["Size D battery2", 3], ["Ion Battery", 3], ["Civil Radio", 3]], requirements: "Player Level 5 Workshop 1" },
            { name: "TV Set", level: 2, description: "Scavenger mode CD -20%", price: 180000, items: [["Size D battery1", 5], ["Size D battery2", 5], ["Videotape", 1], ["ElectricDrill", 1]], requirements: "Generator 2 Player Level 1" },
            { name: "TV Set", level: 3, description: "Scavenger mode CD -30%", price: 420000, items: [["Size D battery1", 8], ["Size D battery2", 8], ["Videotape", 5], ["Rat Poison", 2]], requirements: "Generator 3 Player Level 1" },
            { name: "Bookdesk", level: 1, description: "Manual ammo reloading time -10%", price: 50000, items: [["Flash light", 5], ["Energy-saving lamp", 5], ["Socket", 3], ["Civil Radio", 2]], requirements: "\"Homecoming\" Workshop 1" },
            { name: "Bookdesk", level: 2, description: "Manual ammo reloading time -20%", price: 180000, items: [["Tape", 8], ["Antiquarian Book", 4], ["Recorder", 5], ["Power Bank", 4]], requirements: "Generator 2" },
            { name: "Bookdesk", level: 3, description: "Manual ammo reloading time -30%", price: 420000, items: [["Voltage transformer", 2], ["Computer manual", 8], ["Digital sensor", 2], ["Antiquarian Book", 6]], requirements: "Generator 3" },
            // Tech & Utility
            { name: "Generator", level: 1, description: "Increase Fuel capacity, reduce power consumption.", price: 0, items: [], requirements: "" },
            { name: "Generator", level: 2, description: "Increase Fuel capacity, reduce power consumption.", price: 100000, items: [["Lighter fluid", 6], ["Oil can", 8], ["Insulating Tape", 6], ["Spark Plug", 1]], requirements: "\"Handy Tool\" Generator 1" },
            { name: "Generator", level: 3, description: "Increase Fuel capacity, reduce power consumption.", price: 300000, items: [["Imaging module", 4], ["Spark Plug", 4], ["Voltage transformer", 2], ["Marine battery", 3]], requirements: "Generator 2" },
            { name: "Intel Center", level: 1, description: "Show item prices with M.I.C.A.", price: 100000, items: [["CD", 2], ["Size D battery2", 2], ["Size D battery1", 2], ["OldPhone", 1]], requirements: "" },
            { name: "Intel Center", level: 2, description: "Character experience gain +15%", price: 160000, items: [["CD", 4], ["Tape", 3], ["Notebook", 3], ["Radio", 2]], requirements: "Workshop 1" },
            { name: "Intel Center", level: 3, description: "Character experience gain +20%", price: 320000, items: [["CD", 6], ["Tape", 3], ["Videotape", 2], ["Power Bank", 3]], requirements: "Intel Center 2 Toilet 2" },
            { name: "Intel Center", level: 4, description: "Character experience gain +30%", price: 500000, items: [["CD", 10], ["Digital sensor", 4], ["Floppydisk", 3], ["Imaging module", 1]], requirements: "Intel Center 3 Toilet 3" },
            { name: "Bitcoin Mine", level: 1, description: "Generate periodic income using GPUs.", price: 100000, items: [["CPU", 1], ["Rust cleaner", 5], ["RAM", 6], ["Hard Drive", 5]], requirements: "\"Speaking of Finance\" Generator 2" },
            { name: "Bitcoin Mine", level: 2, description: "Unlock more slots; Increase money output.", price: 200000, items: [["CPU", 4], ["CPU Fan", 6], ["RAM", 4], ["Floppydisk", 4]], requirements: "Bitcoin Mine 1" },
            { name: "Bitcoin Mine", level: 3, description: "Unlock more slots; Increase money output.", price: 300000, items: [["CPU", 4], ["CPU Fan", 8], ["RAM", 6], ["Hard Drive", 6]], requirements: "Bitcoin Mine 2" },
            { name: "Bitcoin Mine", level: 4, description: "Unlock more slots; Increase money output.", price: 400000, items: [["CPU", 6], ["CPU Fan", 10], ["RAM", 8], ["Hard Drive", 6]], requirements: "Bitcoin Mine 3 Generator 3" },
            { name: "Shooting Range", level: 1, description: "Infinite ammo for firearms testing.", price: 50000, items: [["Gun oil", 2], ["Insulating Tape", 2], ["Ceramic adhesive", 1], ["Tire Sealant", 3]], requirements: "\"Lights On\"" },
            // Kitchen Area
            { name: "Kitchen Area", level: 1, description: "Unlocks Coffee Machine, Microwave, Refrigerator", price: 80000, items: [["Olive oil", 3], ["Salt can", 2], ["Gas can", 1], ["Large Plier", 1]], requirements: "Water Collector 1" },
            { name: "Water Collector", level: 1, description: "Access to a drink holder. Regenerate Hydration faster.", price: 10000, items: [["Valve", 2], ["Cleaner", 1], ["Salt can", 1], ["Large Plier", 1]], requirements: "\"The Source of Life\"" },
            { name: "Water Collector", level: 2, description: "Regenerate Hydration faster inside Hideout.", price: 50000, items: [["Valve", 5], ["Insulating Tape", 5], ["Boxed Nails", 6], ["Spray can", 2]], requirements: "" },
            { name: "Water Collector", level: 3, description: "Regenerate Hydration faster inside Hideout.", price: 100000, items: [["Valve", 10], ["Cleaner", 4], ["Vehicle battery", 3], ["Piezometer", 1]], requirements: "" },
            { name: "Refrigerator", level: 1, description: "Food and drinks Storage. Regenerate Energy faster.", price: 100000, items: [["Rust cleaner", 2], ["Salt can", 2], ["WD-40", 2], ["Wrench", 1]], requirements: "Kitchen Area 1" },
            { name: "Refrigerator", level: 2, description: "Regenerate Energy faster inside Hideout.", price: 160000, items: [["Olive oil", 2], ["Windproof Matches", 2], ["Wire Cutter", 4], ["Socket", 2]], requirements: "Generator 2" },
            { name: "Refrigerator", level: 3, description: "Regenerate Energy faster inside Hideout.", price: 240000, items: [["Olive oil", 4], ["Windproof Matches", 4], ["Large Plier", 8], ["Copper wire", 2]], requirements: "" },
            { name: "Microwave", level: 1, description: "In-Raid Energy Consumption -5%", price: 100000, items: [["Boxed Bolts", 6], ["Wire Cutter", 2], ["wastechip", 1], ["Oil can", 6]], requirements: "Kitchen Area 1" },
            { name: "Microwave", level: 2, description: "In-Raid Energy Consumption -10%", price: 200000, items: [["Large Plier", 8], ["Gas can", 8], ["wastechip", 5], ["Olive oil", 3]], requirements: "Generator 2" },
            { name: "Microwave", level: 3, description: "In-Raid Energy Consumption -15%", price: 300000, items: [["Copper wire", 6], ["Lighter", 6], ["WD-40", 12], ["Digital sensor", 2]], requirements: "Generator 3" },
            { name: "Coffee Maker", level: 1, description: "In-Raid Hydration Consumption -5%", price: 100000, items: [["Boxed Nuts", 3], ["Boxed Bolts", 2], ["Socket", 5], ["Civil Radio", 5]], requirements: "Kitchen Area 1" },
            { name: "Coffee Maker", level: 2, description: "In-Raid Hydration Consumption -10%", price: 200000, items: [["Boxed Nuts", 5], ["Cleaner", 3], ["Game console", 1], ["Salt can", 6]], requirements: "Generator 2" },
            { name: "Coffee Maker", level: 3, description: "In-Raid Hydration Consumption -15%", price: 300000, items: [["Boxed Nuts", 12], ["ElectricDrill", 3], ["Copper wire", 3], ["Lighter", 3]], requirements: "Generator 3" },
            // Medical
            { name: "Medical Area", level: 1, description: "Access to a syringe holder. Unlocks Med Desk, Plant Stand, Operating Bed", price: 100000, items: [["Disinfectant wipes", 2], ["Band-aids", 3], ["Bottled glucose", 1], ["Portable medical kit", 1]], requirements: "Water Collector 1" },
            { name: "Operating Bed", level: 1, description: "Free limb damage repair every hour. Faster health regen.", price: 60000, items: [["Bottled glucose", 1], ["Disinfectant wipes", 1], ["Energy-saving lamp", 1], ["Band-aids", 1]], requirements: "Medical Area 1 Toilet 1" },
            { name: "Operating Bed", level: 2, description: "Faster health regeneration in Hideout.", price: 120000, items: [["Bottled glucose", 5], ["Medical scissors", 3], ["Band-aids", 2], ["Centrifuge", 1]], requirements: "Generator 2" },
            { name: "Operating Bed", level: 3, description: "Faster health regeneration in Hideout.", price: 240000, items: [["Bottled glucose", 10], ["Medical scissors", 5], ["UV lamp", 3], ["Centrifuge", 1]], requirements: "Player Level 1 Water Collector 3" },
            { name: "Med Desk", level: 1, description: "Drink recovery +10%.", price: 80000, items: [["UV lamp", 1], ["Portable medical kit", 3], ["Band-aids", 2], ["Aspirin", 3]], requirements: "Water Collector 1 Medical Area 1" },
            { name: "Med Desk", level: 2, description: "Drink recovery +20%.", price: 220000, items: [["UV lamp", 3], ["Portable medical kit", 6], ["Asthma medicine", 4], ["Centrifuge", 2]], requirements: "Water Collector 1 Generator 2" },
            { name: "Med Desk", level: 3, description: "Drink recovery +30%.", price: 340000, items: [["UV lamp", 5], ["Portable medical kit", 9], ["Asthma medicine", 5], ["Centrifuge", 3]], requirements: "Water Collector 3" },
            { name: "Plant Stand", level: 1, description: "Food recovery +10%.", price: 80000, items: [["Moldboard", 1], ["Socket", 2], ["Energy-saving lamp", 5], ["Ion Battery", 1]], requirements: "Medical Area 1 Player Level 1 Toilet 1" },
            { name: "Plant Stand", level: 2, description: "Food recovery +20%.", price: 220000, items: [["Moldboard", 6], ["Aspirin", 2], ["Pesticide", 5], ["Gas pipe pliers", 2]], requirements: "Generator 2 Player Level 1" },
            { name: "Plant Stand", level: 3, description: "Food recovery +30%.", price: 340000, items: [["Moldboard", 12], ["Windproof Matches", 6], ["Iodine", 6], ["Gas pipe pliers", 3]], requirements: "Water Collector 3 Player Level 1" },
            // Gunsmith
            { name: "Gunsmith", level: 1, description: "Weapon parts storage capacity + 10kg", price: 10000, items: [["Boxed Bolts", 2], ["Gas can", 2], ["Rust cleaner", 2], ["Cleaner", 2]], requirements: "Workshop 1" },
            { name: "Gunsmith", level: 2, description: "Weapon parts storage capacity + 10kg", price: 80000, items: [["Valve", 2], ["Boxed Nails", 6], ["Ceramic adhesive", 8], ["Floppydisk", 2]], requirements: "Workshop 1" },
            { name: "Gunsmith", level: 3, description: "Weapon parts storage capacity + 10kg", price: 200000, items: [["Power Bank", 6], ["OldPhone", 10], ["Spark Plug", 6], ["Civil Radio", 4]], requirements: "Generator 2" },
            { name: "Gunsmith", level: 4, description: "Weapon parts storage capacity + 10kg", price: 400000, items: [["Super Glue", 10], ["NewPhone", 10], ["Instant glue", 8], ["ElectricDrill", 6]], requirements: "Generator 3" }
        ];

        const STORAGE_KEY = 'exfilzone-hideout-visual';
        const DLC_STORAGE_KEY = 'exfilzone-dlc-owned';
        const FAVORITES_STORAGE_KEY = 'exfilzone-favorites';
        let completedUpgrades = new Set();
        let favoriteUpgrades = new Set();
        let currentFilter = 'all';
        let ownedDlcs = { ntg: false, johnny: false };

        // DLC unlock definitions
        const dlcUnlocks = {
            ntg: [
                'Workshop-1',
                'TV Set-1',
                'Water Collector-1'
            ],
            johnny: [
                'Workshop-1',
                'Storage Room A-1',
                'Shooting Range-1',
                'Intel Center-1'
            ]
        };

        function loadProgress() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                completedUpgrades = new Set(JSON.parse(saved));
            }
            loadFavorites();
            loadDlcStatus();
        }

        function saveProgress() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify([...completedUpgrades]));
        }

        function loadFavorites() {
            const saved = localStorage.getItem(FAVORITES_STORAGE_KEY);
            if (saved) {
                favoriteUpgrades = new Set(JSON.parse(saved));
            }
        }

        function saveFavorites() {
            localStorage.setItem(FAVORITES_STORAGE_KEY, JSON.stringify([...favoriteUpgrades]));
        }

        function toggleFavorite(upgradeId, event) {
            event.stopPropagation();
            if (favoriteUpgrades.has(upgradeId)) {
                favoriteUpgrades.delete(upgradeId);
            } else {
                favoriteUpgrades.add(upgradeId);
            }
            saveFavorites();
            renderUpgrades();
        }

        function loadDlcStatus() {
            const saved = localStorage.getItem(DLC_STORAGE_KEY);
            if (saved) {
                ownedDlcs = JSON.parse(saved);
            } else {
                // First visit - expand the DLC section and scroll to it
                const dlcSection = document.getElementById('dlcSection');
                dlcSection.classList.add('expanded');
                setTimeout(() => {
                    dlcSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 100);
            }
            updateDlcUI();
        }

        function saveDlcStatus() {
            localStorage.setItem(DLC_STORAGE_KEY, JSON.stringify(ownedDlcs));
        }

        function updateDlcUI() {
            document.getElementById('dlc-ntg-checkbox').checked = ownedDlcs.ntg;
            document.getElementById('dlc-johnny-checkbox').checked = ownedDlcs.johnny;
            document.getElementById('dlc-ntg').classList.toggle('selected', ownedDlcs.ntg);
            document.getElementById('dlc-johnny').classList.toggle('selected', ownedDlcs.johnny);
        }

        function openDlcModal() {
            document.getElementById('dlcModal').classList.add('active');
        }

        function closeDlcModal(event) {
            if (!event || event.target === event.currentTarget) {
                document.getElementById('dlcModal').classList.remove('active');
            }
        }

        function toggleDlc(dlcId) {
            ownedDlcs[dlcId] = !ownedDlcs[dlcId];
            saveDlcStatus();
            updateDlcUI();
            applyDlcUnlocks();
            renderUpgrades();
            renderItemsSummary();
            renderUpNext();
        }

        function applyDlcUnlocks() {
            // Apply unlocks for owned DLCs
            Object.entries(ownedDlcs).forEach(([dlcId, owned]) => {
                if (owned && dlcUnlocks[dlcId]) {
                    dlcUnlocks[dlcId].forEach(upgradeId => {
                        completedUpgrades.add(upgradeId);
                    });
                }
            });
            saveProgress();
        }

        function formatPrice(price) {
            if (price === 0) return 'FREE';
            return '$' + price.toLocaleString();
        }

        function getItemIcon(itemName) {
            const imagePath = itemImages[itemName];
            if (imagePath) {
                return `<img src="${imagePath}" class="item-icon" alt="${itemName}" title="${itemName}" onerror="this.style.display='none'">`;
            }
            return '';
        }

        function getItemCategoryBadge(itemName) {
            const category = itemCategories[itemName];
            if (!category) return '';
            const categoryClass = 'cat-' + category.toLowerCase().replace(' ', '');
            return `<span class="item-category-badge ${categoryClass}">${category}</span>`;
        }

        function renderUpgrades() {
            const container = document.getElementById('upgradesContainer');
            const searchTerm = document.getElementById('searchBox').value.toLowerCase();
            let html = '';

            Object.entries(hideoutGroups).forEach(([groupName, stationNames]) => {
                const groupUpgrades = hideoutUpgrades.filter(upgrade => stationNames.includes(upgrade.name));

                const filteredUpgrades = groupUpgrades.filter(upgrade => {
                    const upgradeId = `${upgrade.name}-${upgrade.level}`;
                    const isCompleted = completedUpgrades.has(upgradeId);
                    const isFavorite = favoriteUpgrades.has(upgradeId);

                    if (currentFilter === 'completed' && !isCompleted) return false;
                    if (currentFilter === 'incomplete' && isCompleted) return false;
                    if (currentFilter === 'favorites' && !isFavorite) return false;

                    const searchableText = `${groupName} ${upgrade.name} ${upgrade.description} ${upgrade.items.map(i => i[0]).join(' ')}`.toLowerCase();
                    if (searchTerm && !searchableText.includes(searchTerm)) return false;

                    return true;
                });

                if (filteredUpgrades.length === 0) return;

                const completedInGroup = groupUpgrades.filter(u => completedUpgrades.has(`${u.name}-${u.level}`)).length;

                html += `
                    <div class="category-section">
                        <div class="category-header">
                            <span class="category-title">${groupName}</span>
                            <span class="category-progress">${completedInGroup}/${groupUpgrades.length} Complete</span>
                        </div>
                        <div class="cards-grid">
                `;

                filteredUpgrades.forEach(upgrade => {
                    const upgradeId = `${upgrade.name}-${upgrade.level}`;
                    const isCompleted = completedUpgrades.has(upgradeId);
                    const isFavorite = favoriteUpgrades.has(upgradeId);

                    let itemsHtml = '';
                    if (upgrade.items.length === 0) {
                        itemsHtml = '<div class="no-items">No items required</div>';
                    } else {
                        itemsHtml = '<div class="items-list">';
                        upgrade.items.forEach(([item, quantity]) => {
                            const itemSearchUrl = `itemspawns.html?search=${encodeURIComponent(item)}`;
                            itemsHtml += `
                                <div class="item-row">
                                    ${getItemIcon(item)}
                                    <span class="item-name"><a href="${itemSearchUrl}" onclick="event.stopPropagation()" title="Find ${item} spawn locations">${item}</a></span>
                                    ${getItemCategoryBadge(item)}
                                    <span class="item-quantity">x${quantity}</span>
                                </div>
                            `;
                        });
                        itemsHtml += '</div>';
                    }

                    const hideoutImage = hideoutImages[upgrade.name];
                    const imageHtml = hideoutImage ? `<div class="card-image"><img src="${hideoutImage}" alt="${upgrade.name}" onerror="this.parentElement.style.display='none'"></div>` : '';

                    const isLocked = !isCompleted && !areRequirementsMet(upgrade);
                    const favoriteBtn = !isCompleted && !isLocked ? `
                                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite('${upgradeId}', event)" title="${isFavorite ? 'Remove from favorites' : 'Add to favorites'}">
                                        ${isFavorite ? '★' : '☆'}
                                    </button>` : '';

                    let cardClass = '';
                    let badge = '';
                    if (isCompleted) {
                        cardClass = 'completed';
                        badge = '<div class="completed-badge">✓</div>';
                    } else if (isLocked) {
                        cardClass = 'locked';
                        badge = '<div class="locked-badge">🔒</div>';
                    }

                    html += `
                        <div class="upgrade-card ${cardClass}" onclick="toggleUpgrade('${upgradeId}')">
                            ${badge}
                            <div class="card-header">
                                <div class="card-title-row">
                                    <span class="card-name">${upgrade.name}</span>
                                    <div class="card-title-right">
                                        <span class="card-level">LV ${upgrade.level}</span>
                                        ${favoriteBtn}
                                    </div>
                                </div>
                                <div class="card-description">${upgrade.description}</div>
                            </div>
                            ${imageHtml}
                            <div class="card-body">
                                <div class="card-price">
                                    <span class="price-icon">$</span>
                                    <span class="price-value">${formatPrice(upgrade.price)}</span>
                                </div>
                                <div class="requirements-label">Requirements</div>
                                ${itemsHtml}
                            </div>
                            ${upgrade.requirements ? `<div class="card-footer"><span class="prereq-label">Requires:</span> ${upgrade.requirements}</div>` : ''}
                        </div>
                    `;
                });

                html += '</div></div>';
            });

            container.innerHTML = html;
            updateStats();
            renderFavorites();
            renderItemsSummary();
            renderUpNext();
        }

        // Parse hideout requirements from requirement string (e.g., "Workshop 1 Generator 2")
        function parseHideoutRequirements(reqString) {
            if (!reqString) return [];
            const requirements = [];
            // Match patterns like "Workshop 1", "Generator 2", "Water Collector 1", "Intel Center 2", etc.
            // Exclude quest requirements in quotes and "Player Level" requirements
            const cleanedReq = reqString.replace(/"[^"]+"/g, '').replace(/Player Level \d+/g, '');

            // Known hideout upgrade names to match
            const hideoutNames = [
                'Workshop', 'Storage Room A', 'Storage Room B', 'Storage Room C',
                'Toilet', 'Sofa', 'TV Set', 'Bookdesk',
                'Generator', 'Intel Center', 'Bitcoin Mine', 'Shooting Range',
                'Kitchen Area', 'Water Collector', 'Refrigerator', 'Microwave', 'Coffee Maker',
                'Medical Area', 'Operating Bed', 'Med Desk', 'Plant Stand',
                'Gunsmith'
            ];

            for (const name of hideoutNames) {
                const regex = new RegExp(name + '\\s*(\\d+)', 'g');
                let match;
                while ((match = regex.exec(cleanedReq)) !== null) {
                    const level = parseInt(match[1]);
                    if (level) {
                        requirements.push({ name, level });
                    }
                }
            }
            return requirements;
        }

        // Check if all hideout requirements are met for an upgrade
        function areRequirementsMet(upgrade) {
            const requirements = parseHideoutRequirements(upgrade.requirements);
            for (const req of requirements) {
                const reqUpgradeId = `${req.name}-${req.level}`;
                if (!completedUpgrades.has(reqUpgradeId)) {
                    return false;
                }
            }
            return true;
        }

        // Get list of unmet requirements for display
        function getUnmetRequirements(upgrade) {
            const requirements = parseHideoutRequirements(upgrade.requirements);
            const unmet = [];
            for (const req of requirements) {
                const reqUpgradeId = `${req.name}-${req.level}`;
                if (!completedUpgrades.has(reqUpgradeId)) {
                    unmet.push(`${req.name} ${req.level}`);
                }
            }
            return unmet;
        }

        function toggleUpgrade(upgradeId) {
            if (completedUpgrades.has(upgradeId)) {
                completedUpgrades.delete(upgradeId);
            } else {
                // Find the upgrade to check requirements
                const upgrade = hideoutUpgrades.find(u => `${u.name}-${u.level}` === upgradeId);
                if (upgrade && !areRequirementsMet(upgrade)) {
                    const unmet = getUnmetRequirements(upgrade);
                    alert(`Cannot unlock ${upgrade.name} Lv${upgrade.level}.\n\nMissing requirements:\n• ${unmet.join('\n• ')}`);
                    return;
                }
                completedUpgrades.add(upgradeId);
                // Remove from favorites when completed
                if (favoriteUpgrades.has(upgradeId)) {
                    favoriteUpgrades.delete(upgradeId);
                    saveFavorites();
                }
            }
            saveProgress();
            renderUpgrades();
        }

        function toggleAll(completed) {
            if (completed) {
                hideoutUpgrades.forEach(upgrade => {
                    completedUpgrades.add(`${upgrade.name}-${upgrade.level}`);
                });
            } else {
                completedUpgrades.clear();
            }
            saveProgress();
            renderUpgrades();
        }

        function resetProgress() {
            if (confirm('Reset all progress?')) {
                completedUpgrades.clear();
                saveProgress();
                renderUpgrades();
            }
        }

        function updateStats() {
            const total = hideoutUpgrades.length;
            const completed = completedUpgrades.size;
            const percent = Math.round((completed / total) * 100);

            const totalCost = hideoutUpgrades.reduce((sum, u) => sum + u.price, 0);
            const moneySpent = hideoutUpgrades
                .filter(u => completedUpgrades.has(`${u.name}-${u.level}`))
                .reduce((sum, u) => sum + u.price, 0);

            document.getElementById('progressPercent').textContent = percent + '%';
            document.getElementById('completedCount').textContent = `${completed}/${total}`;
            document.getElementById('totalCost').textContent = formatPrice(totalCost);
            document.getElementById('moneySpent').textContent = formatPrice(moneySpent);
        }

        function filterView(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderUpgrades();
        }

        function toggleItemsSummary() {
            const section = document.getElementById('itemsSummarySection');
            section.classList.toggle('expanded');
        }

        function toggleUpNext() {
            const section = document.getElementById('upNextSection');
            section.classList.toggle('expanded');
        }

        function toggleFavoritesSection() {
            const section = document.getElementById('favoritesSection');
            section.classList.toggle('expanded');
        }

        function renderFavorites() {
            const section = document.getElementById('favoritesSection');
            const container = document.getElementById('favoritesUpgrades');
            const stats = document.getElementById('favoritesStats');

            if (favoriteUpgrades.size === 0) {
                section.style.display = 'none';
                return;
            }

            section.style.display = 'block';

            // Get favorite upgrades data
            const favorites = hideoutUpgrades.filter(upgrade => {
                const upgradeId = `${upgrade.name}-${upgrade.level}`;
                return favoriteUpgrades.has(upgradeId);
            });

            // Calculate total items needed for favorites
            const itemTotals = {};
            let incompleteCount = 0;
            favorites.forEach(upgrade => {
                const upgradeId = `${upgrade.name}-${upgrade.level}`;
                const isCompleted = completedUpgrades.has(upgradeId);
                if (!isCompleted) {
                    incompleteCount++;
                    upgrade.items.forEach(([itemName, quantity]) => {
                        if (!itemTotals[itemName]) {
                            itemTotals[itemName] = 0;
                        }
                        itemTotals[itemName] += quantity;
                    });
                }
            });

            let html = '';
            favorites.forEach(upgrade => {
                const upgradeId = `${upgrade.name}-${upgrade.level}`;
                const isCompleted = completedUpgrades.has(upgradeId);

                const itemsHtml = upgrade.items.map(([item, qty]) => {
                    const imagePath = itemImages[item] || '';
                    const iconHtml = imagePath
                        ? `<img src="${imagePath}" class="favorites-item-icon" alt="${item}" onerror="this.style.display='none'">`
                        : '';
                    const itemSearchUrl = `itemspawns.html?search=${encodeURIComponent(item)}`;
                    return `<div class="favorites-item">${iconHtml}<a href="${itemSearchUrl}" title="Find ${item} spawn locations">${item}</a> <span class="favorites-item-qty">x${qty}</span></div>`;
                }).join('');

                html += `
                    <div class="favorites-upgrade ${isCompleted ? 'completed' : ''}">
                        <div class="favorites-upgrade-header">
                            <span class="favorites-upgrade-name">${upgrade.name}</span>
                            <span class="favorites-upgrade-level">${isCompleted ? '✓ COMPLETE' : 'LV ' + upgrade.level}</span>
                        </div>
                        <div class="favorites-items">${itemsHtml || '<span style="color: var(--text-secondary); font-size: 0.8rem;">No items required</span>'}</div>
                    </div>
                `;
            });

            container.innerHTML = html;

            const totalItems = Object.values(itemTotals).reduce((sum, qty) => sum + qty, 0);
            stats.innerHTML = `Tracked: <span>${favorites.length}</span> | Remaining: <span>${incompleteCount}</span> | Items needed: <span>${totalItems}</span>`;
        }

        function getNextUpgrades() {
            // Group upgrades by name
            const upgradesByName = {};
            hideoutUpgrades.forEach(upgrade => {
                if (!upgradesByName[upgrade.name]) {
                    upgradesByName[upgrade.name] = [];
                }
                upgradesByName[upgrade.name].push(upgrade);
            });

            // For each upgrade type, find the next incomplete level
            const nextUpgrades = [];
            Object.entries(upgradesByName).forEach(([name, upgrades]) => {
                // Sort by level
                upgrades.sort((a, b) => a.level - b.level);

                // Find the first incomplete upgrade
                for (const upgrade of upgrades) {
                    const upgradeId = `${upgrade.name}-${upgrade.level}`;
                    if (!completedUpgrades.has(upgradeId)) {
                        nextUpgrades.push(upgrade);
                        break;
                    }
                }
            });

            return nextUpgrades;
        }

        function renderUpNext() {
            const nextUpgrades = getNextUpgrades();
            const container = document.getElementById('upNextUpgrades');
            const stats = document.getElementById('upNextStats');

            if (nextUpgrades.length === 0) {
                container.innerHTML = '<div class="items-summary-empty">All upgrades completed!</div>';
                stats.innerHTML = '';
                return;
            }

            // Calculate total items needed for up next
            const itemTotals = {};
            nextUpgrades.forEach(upgrade => {
                upgrade.items.forEach(([itemName, quantity]) => {
                    if (!itemTotals[itemName]) {
                        itemTotals[itemName] = 0;
                    }
                    itemTotals[itemName] += quantity;
                });
            });

            let html = '';
            nextUpgrades.forEach(upgrade => {
                const itemsHtml = upgrade.items.map(([item, qty]) => {
                    const imagePath = itemImages[item] || '';
                    const iconHtml = imagePath
                        ? `<img src="${imagePath}" class="up-next-item-icon" alt="${item}" onerror="this.style.display='none'">`
                        : '';
                    const itemSearchUrl = `itemspawns.html?search=${encodeURIComponent(item)}`;
                    return `<div class="up-next-item">${iconHtml}<a href="${itemSearchUrl}" title="Find ${item} spawn locations">${item}</a> <span class="up-next-item-qty">x${qty}</span></div>`;
                }).join('');

                html += `
                    <div class="up-next-upgrade">
                        <div class="up-next-upgrade-header">
                            <span class="up-next-upgrade-name">${upgrade.name}</span>
                            <span class="up-next-upgrade-level">LV ${upgrade.level}</span>
                        </div>
                        <div class="up-next-items">${itemsHtml}</div>
                    </div>
                `;
            });

            container.innerHTML = html;

            const uniqueItems = Object.keys(itemTotals).length;
            const totalItems = Object.values(itemTotals).reduce((sum, qty) => sum + qty, 0);
            stats.innerHTML = `Next upgrades: <span>${nextUpgrades.length}</span> | Items needed: <span>${totalItems}</span>`;
        }

        function calculateItemTotals() {
            const itemTotals = {};

            hideoutUpgrades.forEach(upgrade => {
                const upgradeId = `${upgrade.name}-${upgrade.level}`;
                if (!completedUpgrades.has(upgradeId)) {
                    upgrade.items.forEach(([itemName, quantity]) => {
                        if (!itemTotals[itemName]) {
                            itemTotals[itemName] = 0;
                        }
                        itemTotals[itemName] += quantity;
                    });
                }
            });

            return itemTotals;
        }

        function renderItemsSummary() {
            const itemTotals = calculateItemTotals();
            const grid = document.getElementById('itemsSummaryGrid');
            const stats = document.getElementById('itemsSummaryStats');

            const sortedItems = Object.entries(itemTotals)
                .sort((a, b) => b[1] - a[1]);

            if (sortedItems.length === 0) {
                grid.innerHTML = '<div class="items-summary-empty">All upgrades completed! No items needed.</div>';
                stats.innerHTML = '';
                return;
            }

            let html = '';
            sortedItems.forEach(([itemName, quantity]) => {
                const imagePath = itemImages[itemName] || '';
                const iconHtml = imagePath
                    ? `<img src="${imagePath}" class="summary-item-icon" alt="${itemName}" title="${itemName}" onerror="this.style.display='none'">`
                    : '';
                const itemSearchUrl = `itemspawns.html?search=${encodeURIComponent(itemName)}`;

                html += `
                    <div class="summary-item">
                        ${iconHtml}
                        <span class="summary-item-name"><a href="${itemSearchUrl}" title="Find ${itemName} spawn locations">${itemName}</a></span>
                        <span class="summary-item-qty">x${quantity}</span>
                    </div>
                `;
            });

            grid.innerHTML = html;

            const uniqueItems = sortedItems.length;
            const totalItems = sortedItems.reduce((sum, [, qty]) => sum + qty, 0);
            stats.innerHTML = `Unique items: <span>${uniqueItems}</span> | Total items: <span>${totalItems}</span>`;
        }

        document.getElementById('searchBox').addEventListener('input', renderUpgrades);

        // Sidebar toggle functionality
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                sidebar.classList.toggle('mobile-open');
            } else {
                sidebar.classList.toggle('collapsed');
            }

            // Save preference
            localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
        }

        // Load sidebar state
        function loadSidebarState() {
            const collapsed = localStorage.getItem('sidebarCollapsed') === 'true';
            const sidebar = document.getElementById('sidebar');
            if (collapsed && window.innerWidth > 768) {
                sidebar.classList.add('collapsed');
            }
        }

        loadSidebarState();
        loadProgress();
        renderUpgrades();
        renderFavorites();
        renderItemsSummary();
        renderUpNext();
    </script>
    </div>
</body>
</html>
